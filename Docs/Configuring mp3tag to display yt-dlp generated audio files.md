# Configuring mp3tag to Display yt-dlp Generated Audio Files

This guide explains how to configure mp3tag to properly display and edit metadata tags in MP3, M4A, and FLAC files generated by this yt-dlp-based downloader.

## Overview

This project generates MP3, M4A, and FLAC audio files with specific metadata tags that may require custom configuration in mp3tag to display correctly. The tool embeds metadata including:

- Standard tags (title, artist, album, year, genre)
- Embedded album artwork (thumbnail from YouTube)
- Custom tags for tracking original filenames (TENC for MP3, ©lyr for M4A, ENCODEDBY for FLAC)
- Chapter information (when using `--split-chapters`)
- Greek artist names and metadata

The project uses different tagging systems:
- **MP3 files**: ID3v2 tags (frames like TIT2, TPE1, TENC)
- **M4A files**: MP4/iTunes-style atoms (like ©nam, ©ART, ©lyr)
- **FLAC files**: Vorbis Comments (like TITLE, ARTIST, DESCRIPTION)

## Recommended mp3tag Configuration

### Tag Panel Columns

To view all relevant metadata, configure mp3tag to display these columns:

1. **Title** - `%title%`
2. **Artist** - `%artist%`
3. **Album Artists** - `%albumartist%`
4. **Album** - `%album%`
5. **Year** - `%year%`
5. **Genre** - `%genre%`
6. **Comment** - `%comment%`
7. **Encoded By** - `%encodedby%` (stores original title, MP3)
8. **Lyrics** - `@lyr` (stores original title, M4A)

### Viewing Custom Tags

Some tags used by this project may not appear in the default mp3tag view:

**For MP3 files:**
- **TENC (Encoded by)**: Contains the original YouTube filename before sanitization

**For M4A files:**
- **©lyr (Lyrics)**: Contains the original YouTube filename before sanitization

**For FLAC files:**
- **ENCODEDBY**: Contains the original YouTube filename before sanitization

To view these custom tags:
1. Go to **View** → **Extended Tags** (Alt+T)
2. For MP3: Look for 'ENCODEDBY' field (maps to TENC frame)
3. For M4A: Look for '©lyr' or 'LYRICS' field
4. For FLAC: Look for 'ENCODEDBY' field

### Handling Greek Text

If working with Greek music files:

**For MP3 files:**
1. Ensure mp3tag uses Unicode (UTF-8) encoding
2. Go to **Tools** → **Options** → **Tags** → **Mpeg**
3. Set ID3v2 to **Write ID3v2.4 UTF-8** (recommended) or **ID3v2.3 UTF-16**
4. This ensures Greek characters display correctly without corruption

**For M4A files:**
- M4A/MP4 tags always use UTF-8 encoding
- Greek characters should display correctly by default
- No special configuration needed

**For FLAC files:**
- FLAC Vorbis Comments always use UTF-8 encoding
- Greek characters should display correctly by default
- No special configuration needed

### Batch Operations

For batch editing files generated by this tool:

1. **Filter by source**: Use `%encodedby%` to identify files processed by this tool
2. **Update artists**: If the artist database is updated, you can batch-update artist tags
3. **Re-embed artwork**: Use **Actions** → **Import cover from file** if needed

## Tag Mapping Reference

### MP3 Files (ID3v2 Tags)

| ID3v2 Frame | mp3tag Field | Purpose in This Project |
|-------------|--------------|-------------------------|
| TIT2        | TITLE | Video title or chapter name |
| TPE1        | ARTIST | Detected Greek artist or uploader |
| TALB        | ALBUM | YouTube playlist name or video title |
| TPE2        | ALBUMARTIST | Same as ARTIST |
| TDRC        | YEAR | Upload date (YYYY format) |
| TCON        | GENRE | Set to 'Greek Music' or detected genre |
| COMM        | COMMENT | YouTube video description (excerpt) |
| TENC        | ENCODEDBY | Original filename before sanitization |
| APIC        | Picture | Embedded thumbnail from YouTube |

### M4A Files (MP4/iTunes Atoms)

| MP4 Atom | mp3tag Field | Purpose in This Project |
|----------|--------------|-------------------------|
| ©nam | TITLE | Video title or chapter name |
| ©ART | ARTIST | Detected Greek artist or uploader |
| aART | ALBUMARTIST | Album artist (same as artist) |
| ©alb | ALBUM | YouTube playlist name or video title |
| ©day | YEAR/DATE | Upload date (YYYY format, auto-reformatted) |
| ©lyr | LYRICS | Original filename before sanitization |
| trkn | TRACKNUMBER | Track number (for chapter files) |
| covr | Picture | Embedded thumbnail from YouTube |

### FLAC Files (Vorbis Comments)

| Vorbis Comment | mp3tag Field | Purpose in This Project |
|----------------|--------------|-------------------------|
| TITLE | TITLE | Video title or chapter name |
| ARTIST | ARTIST | Detected Greek artist or uploader |
| ALBUMARTIST | ALBUMARTIST | Album artist (same as artist) |
| ALBUM | ALBUM | YouTube playlist name or video title |
| DATE | YEAR/DATE | Upload date (YYYY format) |
| GENRE | GENRE | Set to 'Greek Music' or detected genre |
| COMMENT | COMMENT | YouTube video URL |
| ENCODEDBY | ENCODEDBY | Original filename before sanitization |
| TRACKNUMBER | TRACKNUMBER | Track number (for chapter files) |
| Picture | Picture | Embedded thumbnail from YouTube |

## Troubleshooting

### Missing Thumbnails
If album art doesn't display:
- Check **View** → **Cover** is enabled
- For MP3: Verify APIC frames exist in **Extended Tags**
- For M4A: Verify 'covr' atom exists in **Extended Tags**
- For FLAC: Verify embedded picture exists in **Extended Tags**
- Ensure image format is supported (JPEG/PNG)

### Garbled Greek Text

**For MP3 files:**
- Files may be using ID3v2.3 with incorrect encoding
- Convert to ID3v2.4 UTF-8: Select files → **Convert** → **Tag-Tag** → Set ID3v2 version

**For M4A files:**
- M4A files use UTF-8 by default; corruption is rare
- If issues occur, re-download or regenerate the file

**For FLAC files:**
- FLAC Vorbis Comments use UTF-8 by default; corruption is rare
- If issues occur, re-download or regenerate the file

### Original Filename Not Visible

**For MP3 files:**
- Original YouTube filename is stored in TENC (Encoded by) tag
- Add 'Encoded By' column to tag panel
- Or view in **Extended Tags** (Alt+T) as 'ENCODEDBY'

**For M4A files:**
- Original YouTube filename is stored in ©lyr (Lyrics) tag
- Add 'Lyrics' column to tag panel or use `%lyrics%`
- Or view in **Extended Tags** (Alt+T) as '©lyr' or 'LYRICS'

**For FLAC files:**
- Original YouTube filename is stored in ENCODEDBY tag
- Add 'Encoded By' column to tag panel or use `%encodedby%`
- Or view in **Extended Tags** (Alt+T) as 'ENCODEDBY'

### Year Format Issues (M4A only)
- The tool automatically converts YYYYMMDD to YYYY format
- If year shows as 8 digits, it may have been edited externally
- Re-run the tool to fix the format automatically

## Best Practices

1. **Always backup** before batch operations on your music library
2. **Use filters** to work with specific subsets (e.g., files from a specific playlist)
3. **Preserve custom tags** when editing:
   - For MP3: Avoid removing TENC/ENCODEDBY field
   - For M4A: Avoid removing ©lyr/LYRICS field
   - For FLAC: Avoid removing ENCODEDBY field
4. **Export configurations** for team members working with the same files
5. **Keep formats separate** when batch editing to avoid format-specific issues

## Additional Resources

- mp3tag Documentation: https://docs.mp3tag.de/
- ID3v2.4 Specification: https://id3.org/id3v2.4.0-structure
- Project's artist database: `Data/artists.json`

## Format Comparison

| Feature | MP3 (ID3v2) | M4A (MP4/iTunes) | FLAC (Vorbis Comments) |
|---------|-------------|------------------|------------------------|
| Original filename storage | TENC (Encoded by) | ©lyr (Lyrics) | ENCODEDBY |
| Date format | YYYY | YYYY (auto-fixed from YYYYMMDD) | YYYY |
| Encoding | UTF-8 (ID3v2.4) or UTF-16 (ID3v2.3) | Always UTF-8 | Always UTF-8 |
| Greek text support | Requires ID3v2.4 UTF-8 | Native UTF-8 support | Native UTF-8 support |
| Album art tag | APIC frame | covr atom | Picture block |
| Track number format | String ('1', '2', etc.) | Tuple (track, total_tracks) | String ('1', '2', etc.) |
| Audio quality | Lossy | Lossy | Lossless |
| File size | Small | Small | Large |

## Notes

- This project supports MP3, M4A, and FLAC audio formats
- MP3 uses ID3v2 tags; M4A uses MP4/iTunes-style atoms; FLAC uses Vorbis Comments
- Chapter-split files are automatically organized into subdirectories
- M4A and FLAC formats provide better Unicode support out of the box
- FLAC is lossless but produces larger file sizes compared to MP3/M4A
